<div class="settings-page">
  <h1>Account Settings</h1>

  <div class="settings-grid">
    <!-- Change Password -->
    <div class="setting-card">
      <div class="sc-header">
        <h3>Change Password</h3>
        <p>Update your account password</p>
      </div>
      <button class="btn-outline" (click)="showChangePassword = !showChangePassword">
        {{ showChangePassword ? 'Cancel' : 'Change Password' }}
      </button>

      <div class="sc-form" *ngIf="showChangePassword">
        <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
          <div class="form-group">
            <label>Current Password</label>
            <input type="password" formControlName="currentPassword" />
            <span class="error-message"
              *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
              Current password is required
            </span>
          </div>
          <div class="form-group">
            <label>New Password</label>
            <input type="password" formControlName="newPassword" />
            <span class="error-message"
              *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
              Min 6 characters
            </span>
          </div>
          <div class="form-group">
            <label>Confirm Password</label>
            <input type="password" formControlName="confirmPassword" />
            <span class="error-message"
              *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched">
              Passwords don't match
            </span>
          </div>
          <button type="submit" class="btn-accent" [disabled]="passwordForm.invalid">Update Password</button>
        </form>
      </div>
    </div>

    <!-- Update Profile -->
    <div class="setting-card">
      <div class="sc-header">
        <h3>Update Profile</h3>
        <p>Change your personal information</p>
      </div>
      <button class="btn-outline" (click)="showUpdateProfile = !showUpdateProfile">
        {{ showUpdateProfile ? 'Cancel' : 'Update Profile' }}
      </button>

      <div class="sc-form" *ngIf="showUpdateProfile">
        <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
          <div class="form-grid">
            <div class="form-group">
              <label>First Name</label>
              <input type="text" formControlName="nameUs" />
            </div>
            <div class="form-group">
              <label>Last Name</label>
              <input type="text" formControlName="lastNameUs" />
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label>Phone</label>
              <input type="text" formControlName="phoneUs" />
            </div>
            <div class="form-group">
              <label>Address</label>
              <input type="text" formControlName="addressUs" />
            </div>
          </div>
          <div class="form-group">
            <label>Province</label>
            <select formControlName="province">
              <option value="">Select a province</option>
              <option *ngFor="let p of provinces" [value]="p.id">{{ p.nombre }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Municipality</label>
            <select formControlName="municipality">
              <option value="">Select a municipality</option>
              <option *ngFor="let m of municipalities" [value]="m.id">{{ m.nombre }}</option>
            </select>
          </div>
          <button type="submit" class="btn-accent" [disabled]="profileForm.invalid">Save Changes</button>
        </form>
      </div>
    </div>

    <!-- Delete Account -->
    <div class="setting-card setting-card--danger">
      <div class="sc-header">
        <h3>Delete Account</h3>
        <p>Permanently delete your account and all data</p>
      </div>
      <button class="btn-danger" (click)="showDeleteAccount = !showDeleteAccount">
        {{ showDeleteAccount ? 'Cancel' : 'Delete Account' }}
      </button>

      <div class="sc-form" *ngIf="showDeleteAccount">
        <div class="danger-banner">
          This action cannot be undone. All your data will be permanently deleted.
        </div>
        <form [formGroup]="deleteForm" (ngSubmit)="deleteAccount()">
          <div class="form-group">
            <label>Enter your password to confirm</label>
            <input type="password" formControlName="password" />
            <span class="error-message"
              *ngIf="deleteForm.get('password')?.invalid && deleteForm.get('password')?.touched">
              Password is required
            </span>
          </div>
          <div class="form-group">
            <label>Type "DELETE" to confirm</label>
            <input type="text" formControlName="confirmText" placeholder="DELETE" />
            <span class="error-message"
              *ngIf="deleteForm.hasError('confirmTextMismatch') && deleteForm.get('confirmText')?.touched">
              You must type "DELETE"
            </span>
          </div>
          <button type="submit" class="btn-danger" [disabled]="deleteForm.invalid">Delete My Account Forever</button>
        </form>
      </div>
    </div>
  </div>
</div>